<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    position:absolute;
    top:0;
    left:0;
    background-color: black;
}
html, body {
    overflow: hidden;
}
body {
  background: black;
}
</style>
</head>

<body onload="startGame()">

<img src="pic/ships/ship1a.png" id="ship1a" style="display: none;">
<img src="pic/ships/ship1b.png" id="ship1b" style="display: none;">
<img src="pic/ships/ship1c.png" id="ship1c" style="display: none;">
<img src="pic/ships/ship1d.png" id="ship1d" style="display: none;">
<img src="pic/ships/ship1e.png" id="ship1e" style="display: none;">

<img src="pic/ships/ship2a.png" id="ship2a" style="display: none;">
<img src="pic/ships/ship2b.png" id="ship2b" style="display: none;">
<img src="pic/ships/ship2c.png" id="ship2c" style="display: none;">
<img src="pic/ships/ship2d.png" id="ship2d" style="display: none;">
<img src="pic/ships/ship2e.png" id="ship2e" style="display: none;">

<img src="pic/texture/water.jpg" id="water" style="display: none;">

<img src="pic/exp/ex1.png" id="ex1" style="display: none;">
<img src="pic/exp/ex2.png" id="ex2" style="display: none;">
<img src="pic/exp/ex3.png" id="ex3" style="display: none;">
<img src="pic/exp/ex4.png" id="ex4" style="display: none;">
<img src="pic/exp/ex5.png" id="ex5" style="display: none;">
<img src="pic/exp/ex6.png" id="ex6" style="display: none;">
<img src="pic/exp/ex7.png" id="ex7" style="display: none;">
<img src="pic/exp/ex8.png" id="ex8" style="display: none;">
<img src="pic/exp/ex9.png" id="ex9" style="display: none;">
<img src="pic/exp/ex10.png" id="ex10" style="display: none;">
<img src="pic/exp/ex11.png" id="ex11" style="display: none;">
<img src="pic/exp/ex12.png" id="ex12" style="display: none;">
<img src="pic/exp/ex13.png" id="ex13" style="display: none;">
<img src="pic/exp/ex14.png" id="ex14" style="display: none;">
<img src="pic/exp/ex15.png" id="ex15" style="display: none;">
<img src="pic/exp/ex16.png" id="ex16" style="display: none;">
<img src="pic/exp/ex17.png" id="ex17" style="display: none;">
<img src="pic/exp/ex18.png" id="ex18" style="display: none;">
<img src="pic/exp/ex19.png" id="ex19" style="display: none;">
<img src="pic/exp/ex20.png" id="ex20" style="display: none;">
<img src="pic/exp/ex21.png" id="ex21" style="display: none;">
<img src="pic/exp/ex22.png" id="ex22" style="display: none;">
<img src="pic/exp/ex23.png" id="ex23" style="display: none;">
<img src="pic/exp/ex24.png" id="ex24" style="display: none;">
<img src="pic/exp/ex25.png" id="ex25" style="display: none;">
<img src="pic/exp/ex26.png" id="ex26" style="display: none;">
<img src="pic/exp/ex27.png" id="ex27" style="display: none;">
<img src="pic/exp/ex28.png" id="ex28" style="display: none;">
<img src="pic/exp/ex29.png" id="ex29" style="display: none;">
<img src="pic/exp/ex30.png" id="ex30" style="display: none;">
<img src="pic/exp/ex31.png" id="ex31" style="display: none;">
<img src="pic/exp/ex32.png" id="ex32" style="display: none;">
<img src="pic/exp/ex33.png" id="ex33" style="display: none;">
<img src="pic/exp/ex34.png" id="ex34" style="display: none;">
<img src="pic/exp/ex35.png" id="ex35" style="display: none;">
<img src="pic/exp/ex36.png" id="ex36" style="display: none;">
<img src="pic/exp/ex37.png" id="ex37" style="display: none;">
<img src="pic/exp/ex38.png" id="ex38" style="display: none;">
<img src="pic/exp/ex39.png" id="ex39" style="display: none;">
<img src="pic/exp/ex40.png" id="ex40" style="display: none;">
<img src="pic/exp/ex41.png" id="ex41" style="display: none;">
<img src="pic/exp/ex42.png" id="ex42" style="display: none;">
<img src="pic/exp/ex43.png" id="ex43" style="display: none;">
<img src="pic/exp/ex44.png" id="ex44" style="display: none;">
<img src="pic/exp/ex45.png" id="ex45" style="display: none;">
<img src="pic/exp/ex46.png" id="ex46" style="display: none;">
<img src="pic/exp/ex47.png" id="ex47" style="display: none;">
<img src="pic/exp/ex48.png" id="ex48" style="display: none;">
<img src="pic/exp/ex49.png" id="ex49" style="display: none;">
<img src="pic/exp/ex50.png" id="ex50" style="display: none;">
<img src="pic/exp/ex51.png" id="ex51" style="display: none;">
<img src="pic/exp/ex52.png" id="ex52" style="display: none;">
<img src="pic/exp/ex53.png" id="ex53" style="display: none;">
<img src="pic/exp/ex54.png" id="ex54" style="display: none;">
<img src="pic/exp/ex55.png" id="ex55" style="display: none;">
<img src="pic/exp/ex56.png" id="ex56" style="display: none;">
<img src="pic/exp/ex57.png" id="ex57" style="display: none;">
<img src="pic/exp/ex58.png" id="ex58" style="display: none;">
<img src="pic/exp/ex59.png" id="ex59" style="display: none;">
<img src="pic/exp/ex60.png" id="ex60" style="display: none;">
<img src="pic/exp/ex61.png" id="ex61" style="display: none;">
<img src="pic/exp/ex62.png" id="ex62" style="display: none;">
<img src="pic/exp/ex63.png" id="ex63" style="display: none;">
<img src="pic/exp/ex64.png" id="ex64" style="display: none;">

<img src="pic/hit/hit1.png" id="hit1" style="display: none;">
<img src="pic/hit/hit2.png" id="hit2" style="display: none;">
<img src="pic/hit/hit3.png" id="hit3" style="display: none;">
<img src="pic/hit/hit4.png" id="hit4" style="display: none;">
<img src="pic/hit/hit5.png" id="hit5" style="display: none;">
<img src="pic/hit/hit6.png" id="hit6" style="display: none;">
<img src="pic/hit/hit7.png" id="hit7" style="display: none;">
<img src="pic/hit/hit8.png" id="hit8" style="display: none;">
<img src="pic/hit/hit9.png" id="hit9" style="display: none;">
<img src="pic/hit/hit10.png" id="hit10" style="display: none;">
<img src="pic/hit/hit11.png" id="hit11" style="display: none;">
<img src="pic/hit/hit12.png" id="hit12" style="display: none;">
<img src="pic/hit/hit13.png" id="hit13" style="display: none;">
<img src="pic/hit/hit14.png" id="hit14" style="display: none;">
<img src="pic/hit/hit15.png" id="hit15" style="display: none;">
<img src="pic/hit/hit16.png" id="hit16" style="display: none;">
<img src="pic/hit/hit17.png" id="hit17" style="display: none;">
<img src="pic/hit/hit18.png" id="hit18" style="display: none;">
<img src="pic/hit/hit19.png" id="hit19" style="display: none;">
<img src="pic/hit/hit20.png" id="hit20" style="display: none;">
<img src="pic/hit/hit21.png" id="hit21" style="display: none;">
<img src="pic/hit/hit22.png" id="hit22" style="display: none;">
<img src="pic/hit/hit23.png" id="hit23" style="display: none;">
<img src="pic/hit/hit24.png" id="hit24" style="display: none;">
<img src="pic/hit/hit25.png" id="hit25" style="display: none;">
<img src="pic/hit/hit26.png" id="hit26" style="display: none;">
<img src="pic/hit/hit27.png" id="hit27" style="display: none;">
<img src="pic/hit/hit28.png" id="hit28" style="display: none;">
<img src="pic/hit/hit29.png" id="hit29" style="display: none;">
<img src="pic/hit/hit30.png" id="hit30" style="display: none;">
<img src="pic/hit/hit31.png" id="hit31" style="display: none;">
<img src="pic/hit/hit32.png" id="hit32" style="display: none;">
<img src="pic/hit/hit33.png" id="hit33" style="display: none;">
<img src="pic/hit/hit34.png" id="hit34" style="display: none;">
<img src="pic/hit/hit35.png" id="hit35" style="display: none;">
<img src="pic/hit/hit36.png" id="hit36" style="display: none;">
<img src="pic/hit/hit37.png" id="hit37" style="display: none;">
<img src="pic/hit/hit38.png" id="hit38" style="display: none;">
<img src="pic/hit/hit39.png" id="hit39" style="display: none;">
<img src="pic/hit/hit40.png" id="hit40" style="display: none;">
<img src="pic/hit/hit41.png" id="hit41" style="display: none;">
<img src="pic/hit/hit42.png" id="hit42" style="display: none;">
<img src="pic/hit/hit43.png" id="hit43" style="display: none;">
<img src="pic/hit/hit44.png" id="hit44" style="display: none;">
<img src="pic/hit/hit45.png" id="hit45" style="display: none;">
<img src="pic/hit/hit46.png" id="hit46" style="display: none;">
<img src="pic/hit/hit47.png" id="hit47" style="display: none;">
<img src="pic/hit/hit48.png" id="hit48" style="display: none;">

<script src="js/objects.js"></script>
<script src="js/player.js"></script>
<script src="js/mainInterval.js"></script>
<script src="js/functions.js"></script>
<script src="js/gameUpdate.js"></script>
<script src="js/socket.js"></script>
<script src="js/cookie.js"></script>
<script src="js/annyang.js"></script>


<script>


// preload sounds
var s1=new Audio('sounds/shot1.mp3');
s1.load();
var s2=new Audio('sounds/shot2.mp3');
s2.load();
var s3=new Audio('sounds/shot3.mp3');
s3.load();
var b=new Audio('sounds/background.mp3');
b.load();
var crush=new Audio('sounds/crush.mp3');
crush.load();


// destroyed players ship sound
var sd1 = new Audio('sounds/sd1.wav');
sd1.load();
var sd2 = new Audio('sounds/sd2.wav');
sd2.load();
var sd3 = new Audio('sounds/sd3.wav');
sd3.load();
var sd4 = new Audio('sounds/sd4.wav');
sd4.load();


// GAME VARIABLES

var socket = io();

var person = prompt("Please enter your name (max 20 characters)");
//var person;
//var person = "spectator";

if(person==""||person==null){
  person="Player";
}

person=person.substring(0, 20);


// player kills
var kills=0;

if(CookieJS.get('totalKills')==null){
  CookieJS.set({name:'totalKills',value:kills,expires: 30});
}else{
  kills=parseInt(CookieJS.get('totalKills'));
}
kills=100;
// number of live players in game
var livePlayers=0;

socket.on('liveP', function(number){
    livePlayers=number;
});

// instructions
var infoTime=300;


var tempId=100;
var myGamePiece = new myShip(Math.floor(Math.random()*3072+1), Math.floor(Math.random()*3072+1),
person, tempId, 1);

var otherShips=new Array();
var balls=new Array();
var exps=new Array();
var hits=new Array();

// sound variable
var soundState=0;

// showing manual for player
var showInfo=false;

// showing mini map for player
var showMinimap=false;


///////////////////////////////  CHAT
var text=new Array();
var textReady="";
var writingMode=false;
var preText="TEXT:";

var textMsgArr=new Array();

document.addEventListener('keydown', function(event) {

  if(event.keyCode==78&&!writingMode){
    if(soundState==0){
      soundState=1;
    }else if(soundState==1){
      soundState=2;
    }else if(soundState==2){
      soundState=0;
    }
  }

  if(event.keyCode==66&&!writingMode){
    voiceControl=!voiceControl;
  }

  if(event.keyCode==72&&!writingMode){
    showInfo=!showInfo;
  }

  if(event.keyCode==77&&!writingMode){
    showMinimap=!showMinimap;
  }

  if(event.keyCode==13&&myGamePiece.inGame){
    if(writingMode){
      writingMode=false;
      // player is emiting message
      if(textReady.length>6){
        var txt={"p":person,"t":textReady.substring(5, textReady.length), "c":0};
        socket.emit('chat', txt);
      }
      //console.log(textReady.substring(5, textReady.length));
    }else if(!writingMode){
      writingMode=true;
      text=new Array();
      textReady=preText;
    }
  }

    if(writingMode){
      if(event.keyCode!=8){
        if(text.length<60){
          text.push(String.fromCharCode(event.keyCode));
          textReady=preText;
          for(var x=0; x<text.length; x++){
            textReady+=text[x];
          }
        }
      }else{
        text.pop();
        textReady=preText;
        for(var x=0; x<text.length; x++){
          textReady+=text[x];
        }
      }
  }
});

socket.on('chat', function(txt){
    if(textMsgArr.length>10){
      textMsgArr.splice(0,1);
    }
    textMsgArr.push(new textMsg(20, 20, txt.p, txt.t, txt.c));
});

///////////////////// END OF CHAT





///////////////////// ID REQUEST

// fist id variable to recognise user that asks server for id
var firstId1=Math.floor(Math.random()*1000000);
var firstId2=Math.floor(Math.random()*1000000);
// node js connection to data from server
// setting id
socket.on('setId', function(msg1){
  if(msg1.firstId1==firstId1&&msg1.firstId2==firstId2){
    if(msg1.status!=tempId){
      tempId=msg1.status;
      // respawn
      var newPosX=Math.floor(Math.random()*3072+1)
      var newPosY=Math.floor(Math.random()*3072+1);
      myGamePiece = new myShip(newPosX, newPosY, person, tempId, 1);

      // info about joining the game
      var txt={"p":"","t":person+" has joined the game", "c":1};
      socket.emit('chat', txt);
    }
  }
});

// asking for id interval function
function askId() {
setInterval(function(){
  if(person.toString().toLowerCase()!="spectator"){
    if(myGamePiece.id==100){
      var msg1={"firstId1":firstId1,"firstId2":firstId2,"status":tempId};
      socket.emit('setId', msg1);
    }
  }
}, 1000);
}

askId();

/////////////////////////// END OF ID REQUEST



/////////////// SHIP AND BALLS DATA RECEIVING

socket.on('id1', function(ship1){
  if(ship1.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship1.id){
        if(ship1.hp.toString().substring(0, 1)=="D"){
          if(ship1.hp.substring(1, ship1.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship1.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship1.x, ship1.y, ship1.a, 0, ship1.k, ship1.n, ship1.t);
        }else{
          otherShips[x].update(ship1.x, ship1.y, ship1.a, ship1.hp, ship1.k, ship1.n, ship1.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship1.x, ship1.y,
      ship1.a, ship1.id, ship1.n, ship1.hp, ship1.t));
    }
  }
});
socket.on('id2', function(ship2){
  if(ship2.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship2.id){
        if(ship2.hp.toString().substring(0, 1)=="D"){
          if(ship2.hp.substring(1, ship2.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship2.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship2.x, ship2.y, ship2.a, 0, ship2.k, ship2.n, ship2.t);
        }else{
          otherShips[x].update(ship2.x, ship2.y, ship2.a, ship2.hp, ship2.k, ship2.n, ship2.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship2.x, ship2.y,
      ship2.a, ship2.id, ship2.n, ship2.hp, ship2.t));
    }
  }
});
socket.on('id3', function(ship3){
  if(ship3.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship3.id){
        if(ship3.hp.toString().substring(0, 1)=="D"){
          if(ship3.hp.substring(1, ship3.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship3.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship3.x, ship3.y, ship3.a, 0, ship3.k, ship3.n, ship3.t);
        }else{
          otherShips[x].update(ship3.x, ship3.y, ship3.a, ship3.hp, ship3.k, ship3.n, ship3.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship3.x, ship3.y,
      ship3.a, ship3.id, ship3.n, ship3.hp, ship3.t));
    }
  }
});
socket.on('id4', function(ship4){
  if(ship4.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship4.id){
        if(ship4.hp.toString().substring(0, 1)=="D"){
          if(ship4.hp.substring(1, ship4.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship4.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship4.x, ship4.y, ship4.a, 0, ship4.k, ship4.n, ship4.t);
        }else{
          otherShips[x].update(ship4.x, ship4.y, ship4.a, ship4.hp, ship4.k, ship4.n, ship4.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship4.x, ship4.y,
      ship4.a, ship4.id, ship4.n, ship4.hp, ship4.t));
    }
  }
});
socket.on('id5', function(ship5){
  if(ship5.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship5.id){
        if(ship5.hp.toString().substring(0, 1)=="D"){
          if(ship5.hp.substring(1, ship5.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship5.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship5.x, ship5.y, ship5.a, 0, ship5.k, ship5.n, ship5.t);
        }else{
          otherShips[x].update(ship5.x, ship5.y, ship5.a, ship5.hp, ship5.k, ship5.n, ship5.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship5.x, ship5.y,
      ship5.a, ship5.id, ship5.n, ship5.hp, ship5.t));
    }
  }
});
socket.on('id6', function(ship6){
  if(ship6.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship6.id){
        if(ship6.hp.toString().substring(0, 1)=="D"){
          if(ship6.hp.substring(1, ship6.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship6.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship6.x, ship6.y, ship6.a, 0, ship6.k, ship6.n, ship6.t);
        }else{
          otherShips[x].update(ship6.x, ship6.y, ship6.a, ship6.hp, ship6.k, ship6.n, ship6.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship6.x, ship6.y,
      ship6.a, ship6.id, ship6.n, ship6.hp, ship6.t));
    }
  }
});
socket.on('id7', function(ship7){
  if(ship7.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship7.id){
        if(ship7.hp.toString().substring(0, 1)=="D"){
          if(ship7.hp.substring(1, ship7.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship7.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship7.x, ship7.y, ship7.a, 0, ship7.k, ship7.n, ship7.t);
        }else{
          otherShips[x].update(ship7.x, ship7.y, ship7.a, ship7.hp, ship7.k, ship7.n, ship7.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship7.x, ship7.y,
      ship7.a, ship7.id, ship7.n, ship7.hp, ship7.t));
    }
  }
});
socket.on('id8', function(ship8){
  if(ship8.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship8.id){
        if(ship8.hp.toString().substring(0, 1)=="D"){
          if(ship8.hp.substring(1, ship8.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship8.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship8.x, ship8.y, ship8.a, 0, ship8.k, ship8.n, ship8.t);
        }else{
          otherShips[x].update(ship8.x, ship8.y, ship8.a, ship8.hp, ship8.k, ship8.n, ship8.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship8.x, ship8.y,
      ship8.a, ship8.id, ship8.n, ship8.hp, ship8.t));
    }
  }
});
socket.on('id9', function(ship9){
  if(ship9.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship9.id){
        if(ship9.hp.toString().substring(0, 1)=="D"){
          if(ship9.hp.substring(1, ship9.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship9.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship9.x, ship9.y, ship9.a, 0, ship9.k, ship9.n, ship9.t);
        }else{
          otherShips[x].update(ship9.x, ship9.y, ship9.a, ship9.hp, ship9.k, ship9.n, ship9.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship9.x, ship9.y,
      ship9.a, ship9.id, ship9.n, ship9.hp, ship9.t));
    }
  }
});
socket.on('id10', function(ship10){
  if(ship10.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship10.id){
        if(ship10.hp.toString().substring(0, 1)=="D"){
          if(ship10.hp.substring(1, ship10.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":"","t":ship10.n+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship10.x, ship10.y, ship10.a, 0, ship10.k, ship10.n, ship10.t);
        }else{
          otherShips[x].update(ship10.x, ship10.y, ship10.a, ship10.hp, ship10.k, ship10.n, ship10.t);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship10.x, ship10.y,
      ship10.a, ship10.id, ship10.n, ship10.hp, ship6.t));
    }
  }
});


// receiving data and creating balls

// ship1
socket.on('data1', function(ball1){
    balls.push(new ball(ball1.x, ball1.y, ball1.a, 1, ball1.d));
    exps.push(new exp(ball1.x, ball1.y, ball1.a));
});
// ship2
socket.on('data2', function(ball2){
  balls.push(new ball(ball2.x, ball2.y, ball2.a, 2, ball2.d));
  exps.push(new exp(ball2.x, ball2.y, ball2.a));
});
// ship3
socket.on('data3', function(ball3){
  balls.push(new ball(ball3.x, ball3.y, ball3.a, 3, ball3.d));
  exps.push(new exp(ball3.x, ball3.y, ball3.a));
});
// ship4
socket.on('data4', function(ball4){
  balls.push(new ball(ball4.x, ball4.y, ball4.a, 4, ball4.d));
  exps.push(new exp(ball4.x, ball4.y, ball4.a));
});
// ship5
socket.on('data5', function(ball5){
  balls.push(new ball(ball5.x, ball5.y, ball5.a, 5, ball5.d));
  exps.push(new exp(ball5.x, ball5.y, ball5.a));
});
// ship6
socket.on('data6', function(ball6){
  balls.push(new ball(ball6.x, ball6.y, ball6.a, 6, ball6.d));
  exps.push(new exp(ball6.x, ball6.y, ball6.a));
});
// ship7
socket.on('data7', function(ball7){
  balls.push(new ball(ball7.x, ball7.y, ball7.a, 7, ball7.d));
  exps.push(new exp(ball7.x, ball7.y, ball7.a));
});
// ship8
socket.on('data8', function(ball8){
  balls.push(new ball(ball8.x, ball8.y, ball8.a, 8, ball8.d));
  exps.push(new exp(ball8.x, ball8.y, ball8.a));
});
// ship9
socket.on('data9', function(ball9){
  balls.push(new ball(ball9.x, ball9.y, ball9.a, 9, ball9.d));
  exps.push(new exp(ball9.x, ball9.y, ball9.a));
});
// ship10
socket.on('data10', function(ball10){
  balls.push(new ball(ball10.x, ball10.y, ball10.a, 10, ball10.d));
  exps.push(new exp(ball10.x, ball10.y, ball10.a));
});

/////////////// END OF SHIP AND BALLS DATA RECEIVING




///////////////////////// AI


var ai1 = new aiShip(0,0,0,0,"ai1");
var ai2 = new aiShip(0,0,0,0,"ai2");
var ai3 = new aiShip(0,0,0,0,"ai3");
var ai4 = new aiShip(0,0,0,0,"ai4");
var ai5 = new aiShip(0,0,0,0,"ai5");


// sockets for 1st ai ship
socket.on('ship1ai', function(ai){
  if(ai.hp.toString().substring(0, 1)=="D"){
    if(ai.hp.substring(1, ai.hp.length)==myGamePiece.id){
      kills++;
      var txt={"p":"","t":ai1.name+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
      socket.emit('chat', txt);
    }
    ai1.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, 0);
  }else{
    ai1.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, ai.hp);
  }
});
// for its bullets from right side
socket.on('ship1aibr', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai1.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});
// for its bullets from left side
socket.on('ship1aibl', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai1.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});

// sockets for 2nd ai ship
socket.on('ship2ai', function(ai){
  if(ai.hp.toString().substring(0, 1)=="D"){
    if(ai.hp.substring(1, ai.hp.length)==myGamePiece.id){
      kills++;
      var txt={"p":"","t":ai2.name+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
      socket.emit('chat', txt);
    }
    ai2.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, 0);
  }else{
    ai2.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, ai.hp);
  }
});
// for its bullets from right side
socket.on('ship2aibr', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai2.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});
// for its bullets from left side
socket.on('ship2aibl', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai2.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});

// sockets for 3rd ai ship
socket.on('ship3ai', function(ai){
  if(ai.hp.toString().substring(0, 1)=="D"){
    if(ai.hp.substring(1, ai.hp.length)==myGamePiece.id){
      kills++;
      var txt={"p":"","t":ai3.name+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
      socket.emit('chat', txt);
    }
    ai3.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, 0);
  }else{
    ai3.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, ai.hp);
  }
});
// for its bullets from right side
socket.on('ship3aibr', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai3.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});
// for its bullets from left side
socket.on('ship3aibl', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai3.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});

// sockets for 4th ai ship
socket.on('ship4ai', function(ai){
  if(ai.hp.toString().substring(0, 1)=="D"){
    if(ai.hp.substring(1, ai.hp.length)==myGamePiece.id){
      kills++;
      var txt={"p":"","t":ai4.name+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
      socket.emit('chat', txt);
    }
    ai4.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, 0);
  }else{
    ai4.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, ai.hp);
  }
});
// for its bullets from right side
socket.on('ship4aibr', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai4.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});
// for its bullets from left side
socket.on('ship4aibl', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai4.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});

// sockets for 5th ai ship
socket.on('ship5ai', function(ai){
  if(ai.hp.toString().substring(0, 1)=="D"){
    if(ai.hp.substring(1, ai.hp.length)==myGamePiece.id){
      kills++;
      var txt={"p":"","t":ai5.name+" has been killed by "+person+" which has now "+kills+" kills", "c":1};
      socket.emit('chat', txt);
    }
    ai5.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, 0);
  }else{
    ai5.update(ai.n, ai.x, ai.y, ai.a, ai.t1, ai.t2, ai.hp);
  }
});
// for its bullets from right side
socket.on('ship5aibr', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai5.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});
// for its bullets from left side
socket.on('ship5aibl', function(aib){
  balls.push(new ball(aib.x, aib.y, aib.a, ai5.id, aib.d));
  exps.push(new exp(aib.x, aib.y, aib.a));
});




///////////////////////// END OF AI

/////////////// SHIP POSITION SENDING

// interval for data sending
// 1. sending ship data, position and hp

function dataS1() {
setInterval(function(){

  // sending your position
  if(myGamePiece.id==1){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship1={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id1', ship1);
    }else{
      var ship1={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id1', ship1);
    }
  }

  if(myGamePiece.id==2){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship2={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id2', ship2);
    }else{
      var ship2={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id2', ship2);
    }
  }

  if(myGamePiece.id==3){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship3={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id3', ship3);
    }else{
      var ship3={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id3', ship3);
    }
  }

  if(myGamePiece.id==4){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship4={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id4', ship4);
    }else{
      var ship4={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id4', ship4);
    }
  }

  if(myGamePiece.id==5){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship5={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id5', ship5);
    }else{
      var ship5={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id5', ship5);
    }
  }

  if(myGamePiece.id==6){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship6={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id6', ship6);
    }else{
      var ship4={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id6', ship4);
    }
  }

  if(myGamePiece.id==7){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship7={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id7', ship7);
    }else{
      var ship7={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id7', ship7);
    }
  }

  if(myGamePiece.id==8){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship8={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id8', ship8);
    }else{
      var ship8={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id8', ship8);
    }
  }

  if(myGamePiece.id==9){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship9={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id9', ship9);
    }else{
      var ship9={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id9', ship9);
    }
  }

  if(myGamePiece.id==10){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship10={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":myGamePiece.level, "t":1};
      socket.emit('id10', ship10);
    }else{
      var ship10={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":myGamePiece.level, "t":1};
      socket.emit('id10', ship10);
    }
  }

}, 100); // n times per second / 10
}

// running interval functions to send data
dataS1();

/////////////// END OF SHIP POSITION SENDING

var voiceControl = false;

var shipForward = false;
var shipLeft = false;
var shipRight = false;

var shootingOrder=false;
var shootingDir=1;  // 0-all, 1-left, 2-right

var follow=false;
var sName; // for id of ship to follow

var aimLeft=false;
var aimRight=false;

var collide=false;

// voice steering
if (annyang) {


  var com = {

    '(go) forward': function() {
    shipForward=true;
    aimLeft=false;
    aimRight=false;
    follow=false;
    },


    // ship stops following
    'full stop': function() {
    shipForward=false;
    follow=false;
    aimLeft=false;
    aimRight=false;
    },

    // ship still aims / follows
    'stop (moving)': function() {
    shipForward=false;
    },
    'hold': function() {
    shipForward=false;
    },

    // general game controls
    'sound on': function() {
    soundState=0;
    },
    'sound off': function() {
    soundState=2;
    },
    '(show me the) map': function() {
    showMinimap=true;
    },
    'help': function() {
    showInfo=true;
    },
    'show me the game': function() {
    showMinimap=false;
    showInfo=false;
    },
    'voice control': function() {
      voiceControl=true;
    },
    'keyboard control': function() {
      voiceControl=false;
    },

    // ship manual control
    'turn left *a': function(a) {
      shipLeft=true;
      myGamePiece.targetAngle=myGamePiece.angle-a* Math.PI / 180;
    },
    'turn right *a': function(a) {
      shipRight=true;
      myGamePiece.targetAngle=myGamePiece.angle+a* Math.PI / 180;
    },
    'rotate left': function() {
      shipLeft=true;
      myGamePiece.targetAngle=myGamePiece.angle-180* Math.PI / 180;
    },
    'rotate right': function() {
      shipRight=true;
      myGamePiece.targetAngle=myGamePiece.angle+180* Math.PI / 180;
    },
    'stop rotating': function() {
      shipLeft=false;
      shipRight=false;
    },

    // arms use
    'fire left': function() {
      shootingDir=1;
      shootingOrder=true;
    },
    'fire right': function() {
      shootingDir=2;
      shootingOrder=true;
    },
    'fire both sides': function() {
      shootingDir=0;
      shootingOrder=true;
    },
    'stop firing': function() {
      shootingOrder=false;
    },
    'stop shooting': function() {
      shootingOrder=false;
    },
    'cease fire': function() {
      shootingOrder=false;
    },
    'collide': function() { // collide relfects only to follow and aiming functions
      collide=true;
    },
    'target left': function() {
      collide=false;
      aimRight=false;
      aimLeft=true;
    },
    'target right': function() {
      collide=false;
      aimLeft=false;
      aimRight=true;
    },

    // follow command
    'follow *name': function(name) {
      collide=false;
      aimLeft=false;
      aimRight=false;

      var dist=1000;

      if(lev(ai1.name, name)<dist){
        sName=ai1.id;
        dist=lev(ai1.name, name);
      }

      if(lev(ai2.name, name)<dist){
        sName=ai2.id;
        dist=lev(ai2.name, name);
      }

      if(lev(ai3.name, name)<dist){
        sName=ai3.id;
        dist=lev(ai3.name, name);
      }

      if(lev(ai4.name, name)<dist){
        sName=ai4.id;
        dist=lev(ai4.name, name);
      }

      if(lev(ai5.name, name)<dist){
        sName=ai5.id;
        dist=lev(ai5.name, name);
      }

      if(otherShips.length>0){
        for(var z=0; z<otherShips.length;z++){
          if(lev(otherShips[z].name, name)<dist){
            sName=otherShips[z].id;
            dist=lev(otherShips[z].name, name);
          }
        }
      }

      follow=true;
    }

  };


  // Add our commands to annyang
  annyang.addCommands(com);

  annyang.start();

}

</script>

</body>
</html>
