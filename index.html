<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    background-color: black;
}
html, body {
    overflow: hidden;
}
body {
  background: black;
}
</style>
</head>

<body onload="startGame()">

<img src="pic/ships/ship1a.png" id="ship1a" style="display: none;">
<img src="pic/ships/ship1b.png" id="ship1b" style="display: none;">
<img src="pic/ships/ship1c.png" id="ship1c" style="display: none;">
<img src="pic/ships/ship1d.png" id="ship1d" style="display: none;">
<img src="pic/ships/ship1e.png" id="ship1e" style="display: none;">

<img src="pic/texture/water.jpg" id="water" style="display: none;">
<img src="pic/texture/water2.jpg" id="water2" style="display: none;">
<img src="pic/texture/water3.jpg" id="water3" style="display: none;">

<img src="pic/exp/ex1.png" id="ex1" style="display: none;">
<img src="pic/exp/ex2.png" id="ex2" style="display: none;">
<img src="pic/exp/ex3.png" id="ex3" style="display: none;">
<img src="pic/exp/ex4.png" id="ex4" style="display: none;">
<img src="pic/exp/ex5.png" id="ex5" style="display: none;">
<img src="pic/exp/ex6.png" id="ex6" style="display: none;">
<img src="pic/exp/ex7.png" id="ex7" style="display: none;">
<img src="pic/exp/ex8.png" id="ex8" style="display: none;">
<img src="pic/exp/ex9.png" id="ex9" style="display: none;">
<img src="pic/exp/ex10.png" id="ex10" style="display: none;">
<img src="pic/exp/ex11.png" id="ex11" style="display: none;">
<img src="pic/exp/ex12.png" id="ex12" style="display: none;">
<img src="pic/exp/ex13.png" id="ex13" style="display: none;">
<img src="pic/exp/ex14.png" id="ex14" style="display: none;">
<img src="pic/exp/ex15.png" id="ex15" style="display: none;">
<img src="pic/exp/ex16.png" id="ex16" style="display: none;">
<img src="pic/exp/ex17.png" id="ex17" style="display: none;">
<img src="pic/exp/ex18.png" id="ex18" style="display: none;">
<img src="pic/exp/ex19.png" id="ex19" style="display: none;">
<img src="pic/exp/ex20.png" id="ex20" style="display: none;">
<img src="pic/exp/ex21.png" id="ex21" style="display: none;">
<img src="pic/exp/ex22.png" id="ex22" style="display: none;">
<img src="pic/exp/ex23.png" id="ex23" style="display: none;">
<img src="pic/exp/ex24.png" id="ex24" style="display: none;">
<img src="pic/exp/ex25.png" id="ex25" style="display: none;">
<img src="pic/exp/ex26.png" id="ex26" style="display: none;">
<img src="pic/exp/ex27.png" id="ex27" style="display: none;">
<img src="pic/exp/ex28.png" id="ex28" style="display: none;">
<img src="pic/exp/ex29.png" id="ex29" style="display: none;">
<img src="pic/exp/ex30.png" id="ex30" style="display: none;">
<img src="pic/exp/ex31.png" id="ex31" style="display: none;">
<img src="pic/exp/ex32.png" id="ex32" style="display: none;">
<img src="pic/exp/ex33.png" id="ex33" style="display: none;">
<img src="pic/exp/ex34.png" id="ex34" style="display: none;">
<img src="pic/exp/ex35.png" id="ex35" style="display: none;">
<img src="pic/exp/ex36.png" id="ex36" style="display: none;">
<img src="pic/exp/ex37.png" id="ex37" style="display: none;">
<img src="pic/exp/ex38.png" id="ex38" style="display: none;">
<img src="pic/exp/ex39.png" id="ex39" style="display: none;">
<img src="pic/exp/ex40.png" id="ex40" style="display: none;">
<img src="pic/exp/ex41.png" id="ex41" style="display: none;">
<img src="pic/exp/ex42.png" id="ex42" style="display: none;">
<img src="pic/exp/ex43.png" id="ex43" style="display: none;">
<img src="pic/exp/ex44.png" id="ex44" style="display: none;">
<img src="pic/exp/ex45.png" id="ex45" style="display: none;">
<img src="pic/exp/ex46.png" id="ex46" style="display: none;">
<img src="pic/exp/ex47.png" id="ex47" style="display: none;">
<img src="pic/exp/ex48.png" id="ex48" style="display: none;">
<img src="pic/exp/ex49.png" id="ex49" style="display: none;">
<img src="pic/exp/ex50.png" id="ex50" style="display: none;">
<img src="pic/exp/ex51.png" id="ex51" style="display: none;">
<img src="pic/exp/ex52.png" id="ex52" style="display: none;">
<img src="pic/exp/ex53.png" id="ex53" style="display: none;">
<img src="pic/exp/ex54.png" id="ex54" style="display: none;">
<img src="pic/exp/ex55.png" id="ex55" style="display: none;">
<img src="pic/exp/ex56.png" id="ex56" style="display: none;">
<img src="pic/exp/ex57.png" id="ex57" style="display: none;">
<img src="pic/exp/ex58.png" id="ex58" style="display: none;">
<img src="pic/exp/ex59.png" id="ex59" style="display: none;">
<img src="pic/exp/ex60.png" id="ex60" style="display: none;">
<img src="pic/exp/ex61.png" id="ex61" style="display: none;">
<img src="pic/exp/ex62.png" id="ex62" style="display: none;">
<img src="pic/exp/ex63.png" id="ex63" style="display: none;">
<img src="pic/exp/ex64.png" id="ex64" style="display: none;">

<img src="pic/hit/hit1.png" id="hit1" style="display: none;">
<img src="pic/hit/hit2.png" id="hit2" style="display: none;">
<img src="pic/hit/hit3.png" id="hit3" style="display: none;">
<img src="pic/hit/hit4.png" id="hit4" style="display: none;">
<img src="pic/hit/hit5.png" id="hit5" style="display: none;">
<img src="pic/hit/hit6.png" id="hit6" style="display: none;">
<img src="pic/hit/hit7.png" id="hit7" style="display: none;">
<img src="pic/hit/hit8.png" id="hit8" style="display: none;">
<img src="pic/hit/hit9.png" id="hit9" style="display: none;">
<img src="pic/hit/hit10.png" id="hit10" style="display: none;">
<img src="pic/hit/hit11.png" id="hit11" style="display: none;">
<img src="pic/hit/hit12.png" id="hit12" style="display: none;">
<img src="pic/hit/hit13.png" id="hit13" style="display: none;">
<img src="pic/hit/hit14.png" id="hit14" style="display: none;">
<img src="pic/hit/hit15.png" id="hit15" style="display: none;">
<img src="pic/hit/hit16.png" id="hit16" style="display: none;">
<img src="pic/hit/hit17.png" id="hit17" style="display: none;">
<img src="pic/hit/hit18.png" id="hit18" style="display: none;">
<img src="pic/hit/hit19.png" id="hit19" style="display: none;">
<img src="pic/hit/hit20.png" id="hit20" style="display: none;">
<img src="pic/hit/hit21.png" id="hit21" style="display: none;">
<img src="pic/hit/hit22.png" id="hit22" style="display: none;">
<img src="pic/hit/hit23.png" id="hit23" style="display: none;">
<img src="pic/hit/hit24.png" id="hit24" style="display: none;">
<img src="pic/hit/hit25.png" id="hit25" style="display: none;">
<img src="pic/hit/hit26.png" id="hit26" style="display: none;">
<img src="pic/hit/hit27.png" id="hit27" style="display: none;">
<img src="pic/hit/hit28.png" id="hit28" style="display: none;">
<img src="pic/hit/hit29.png" id="hit29" style="display: none;">
<img src="pic/hit/hit30.png" id="hit30" style="display: none;">
<img src="pic/hit/hit31.png" id="hit31" style="display: none;">
<img src="pic/hit/hit32.png" id="hit32" style="display: none;">
<img src="pic/hit/hit33.png" id="hit33" style="display: none;">
<img src="pic/hit/hit34.png" id="hit34" style="display: none;">
<img src="pic/hit/hit35.png" id="hit35" style="display: none;">
<img src="pic/hit/hit36.png" id="hit36" style="display: none;">
<img src="pic/hit/hit37.png" id="hit37" style="display: none;">
<img src="pic/hit/hit38.png" id="hit38" style="display: none;">
<img src="pic/hit/hit39.png" id="hit39" style="display: none;">
<img src="pic/hit/hit40.png" id="hit40" style="display: none;">
<img src="pic/hit/hit41.png" id="hit41" style="display: none;">
<img src="pic/hit/hit42.png" id="hit42" style="display: none;">
<img src="pic/hit/hit43.png" id="hit43" style="display: none;">
<img src="pic/hit/hit44.png" id="hit44" style="display: none;">
<img src="pic/hit/hit45.png" id="hit45" style="display: none;">
<img src="pic/hit/hit46.png" id="hit46" style="display: none;">
<img src="pic/hit/hit47.png" id="hit47" style="display: none;">
<img src="pic/hit/hit48.png" id="hit48" style="display: none;">

<script src="js/objects.js"></script>
<script src="js/player.js"></script>
<script src="js/mainInterval.js"></script>
<script src="js/functions.js"></script>
<script src="js/gameUpdate.js"></script>
<script src="js/socket.js"></script>


<script>

// GAME VARIABLES

//var person = prompt("Please enter your name");
var person = "ship";

var kills=0;

// instructions
var insTime=300;

var socket = io();

var tempId=100;
var myGamePiece = new myShip(Math.floor(Math.random()*1025), Math.floor(Math.random()*1025),
person, tempId);

var otherShips=new Array();
var balls=new Array();
var exps=new Array();
var hits=new Array();




///////////////////////////////  CHAT
var text=new Array();
var textReady="";
var writingMode=false;
var preText="TEXT:";

var textMsgArr=new Array();

document.addEventListener('keydown', function(event) {
  if(event.keyCode==13){
    if(writingMode){
      writingMode=false;
      // player is emiting message
      if(textReady.length>6){
        var txt={"p":person,"t":textReady.substring(5, textReady.length), "c":0};
        socket.emit('chat', txt);
      }
      //console.log(textReady.substring(5, textReady.length));
    }else if(!writingMode){
      writingMode=true;
      text=new Array();
      textReady=preText;
    }
  }

    if(writingMode){
      if(event.keyCode!=8){
        if(text.length<60){
          text.push(String.fromCharCode(event.keyCode));
          textReady=preText;
          for(var x=0; x<text.length; x++){
            textReady+=text[x];
          }
        }
      }else{
        text.pop();
        textReady=preText;
        for(var x=0; x<text.length; x++){
          textReady+=text[x];
        }
      }
  }
});

socket.on('chat', function(txt){
    if(textMsgArr.length>10){
      textMsgArr.splice(0,1);
    }
    textMsgArr.push(new textMsg(20, 20, txt.p, txt.t, txt.c));
});

///////////////////// END OF CHAT





///////////////////// ID REQUEST

// fist id variable to recognise user that asks server for id
var firstId=Math.floor(Math.random()*1000000);

// node js connection to data from server
// setting id
socket.on('setId', function(msg1){
  if(msg1.firstId==firstId){
    if(msg1.status!=tempId){
      tempId=msg1.status;

      // system for avoiding collision with previous position and other ships
      var newPosX;
      var newPosY;
      var newPosXisOK;
      var newPosYisOK;
      do{
        var newPosXisOK=true;
        var newPosYisOK=true;
        newPosX=Math.floor(Math.random()*1025)
        newPosY=Math.floor(Math.random()*1025);
        // checking distance from position of being killed
        if(Math.abs(newPosX-myGamePiece.x)<200){
          newPosXisOK=false;
        }
        if(Math.abs(newPosY-myGamePiece.y)<200){
          newPosYisOK=false;
        }
        // checking distance from other ships
        for(var z=0; z<otherShips.length; z++){
          if(Math.abs(newPosX-otherShips[z].x)<200){
            newPosXisOK=false;
          }
          if(Math.abs(newPosY-otherShips[z].y)<200){
            newPosYisOK=false;
          }
        }
      }while(!newPosXisOK&&!newPosYisOK);
      myGamePiece = new myShip(newPosX, newPosY, person, tempId);
    }
  }
});

// asking for id interval function
function askId() {
setInterval(function(){
    if(myGamePiece.id==100){
      var msg1={"firstId":firstId,"status":tempId};
      socket.emit('setId', msg1);
    }
}, 1000);
}

askId();

/////////////////////////// END OF ID REQUEST



/////////////// SHIP AND BALLS DATA RECEIVING

socket.on('id1', function(ship1){
  if(ship1.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship1.id){
        if(ship1.hp.toString().substring(0, 1)=="D"){
          if(ship1.hp.substring(1, ship1.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":person,"t":" have now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship1.x, ship1.y, ship1.a, 0, ship1.k, ship1.n);
        }else{
          otherShips[x].update(ship1.x, ship1.y, ship1.a, ship1.hp, ship1.k, ship1.n);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship1.x, ship1.y,
      ship1.a, ship1.id, ship1.n, ship1.hp));
    }
  }
});
socket.on('id2', function(ship2){
  if(ship2.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship2.id){
        if(ship2.hp.toString().substring(0, 1)=="D"){
          if(ship2.hp.substring(1, ship2.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":person,"t":" have now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship2.x, ship2.y, ship2.a, 0, ship2.k, ship2.n);
        }else{
          otherShips[x].update(ship2.x, ship2.y, ship2.a, ship2.hp, ship2.k, ship2.n);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship2.x, ship2.y,
      ship2.a, ship2.id, ship2.n, ship2.hp));
    }
  }
});
socket.on('id3', function(ship3){
  if(ship3.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship3.id){
        if(ship3.hp.toString().substring(0, 1)=="D"){
          if(ship3.hp.substring(1, ship3.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":person,"t":" have now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship3.x, ship3.y, ship3.a, 0, ship3.k, ship3.n);
        }else{
          otherShips[x].update(ship3.x, ship3.y, ship3.a, ship3.hp, ship3.k, ship3.n);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship3.x, ship3.y,
      ship3.a, ship3.id, ship3.n, ship3.hp));
    }
  }
});
socket.on('id4', function(ship4){
  if(ship4.id!=myGamePiece.id){
    // checking if the ship is allready on the map
    var newPiece=true;
    for(var x=0; x<otherShips.length; x++){
      if(otherShips[x].id==ship4.id){
        if(ship4.hp.toString().substring(0, 1)=="D"){
          if(ship4.hp.substring(1, ship4.hp.length)==myGamePiece.id){
            kills++;
            var txt={"p":person,"t":" have now "+kills+" kills", "c":1};
            socket.emit('chat', txt);
            myGamePiece.lastInfoText=false;
          }
          otherShips[x].update(ship4.x, ship4.y, ship4.a, 0, ship4.k, ship4.n);
        }else{
          otherShips[x].update(ship4.x, ship4.y, ship4.a, ship4.hp, ship4.k, ship4.n);
        }
        newPiece=false;
      }
    }
    if(newPiece){
      otherShips.push(new otherShip(ship4.x, ship4.y,
      ship4.a, ship4.id, ship4.n, ship4.hp));
    }
  }
});


// receiving data and creating balls

// ship1
socket.on('data1', function(ball1){
    balls.push(new ball(ball1.x, ball1.y, ball1.a, 1));
    exps.push(new exp(ball1.x, ball1.y, ball1.a));
});
// ship2
socket.on('data2', function(ball2){
  balls.push(new ball(ball2.x, ball2.y, ball2.a, 2));
  exps.push(new exp(ball2.x, ball2.y, ball2.a));
});
// ship3
socket.on('data3', function(ball3){
  balls.push(new ball(ball3.x, ball3.y, ball3.a, 3));
  exps.push(new exp(ball3.x, ball3.y, ball3.a));
});
// ship4
socket.on('data4', function(ball4){
  balls.push(new ball(ball4.x, ball4.y, ball4.a, 4));
  exps.push(new exp(ball4.x, ball4.y, ball4.a));
});

/////////////// END OF SHIP AND BALLS DATA RECEIVING

/////////////// SHIP POSITION SENDING

// interval for data sending
// sending ship data, position and hp
function dataS1() {
setInterval(function(){

  // sending your position
  if(myGamePiece.id==1){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship1={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":kills};
      socket.emit('id1', ship1);
    }else{
      var ship1={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":kills};
      socket.emit('id1', ship1);
    }
  }
  if(myGamePiece.id==2){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship2={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":kills};
      socket.emit('id2', ship2);
    }else{
      var ship2={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":kills};
      socket.emit('id2', ship2);
    }
  }
  if(myGamePiece.id==3){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship3={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":kills};
      socket.emit('id3', ship3);
    }else{
      var ship3={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":kills};
      socket.emit('id3', ship3);
    }
  }
  if(myGamePiece.id==4){
    if(myGamePiece.hp==0&&myGamePiece.lastInfo){
      myGamePiece.lastInfo=false;
      var ship4={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":"D"+myGamePiece.lastHit,"k":kills};
      socket.emit('id4', ship4);
    }else{
      var ship4={"id":myGamePiece.id,"x":round(myGamePiece.x, 0),"y":round(myGamePiece.y, 0),
      "a":round(myGamePiece.angle, 4),"n":myGamePiece.name,"hp":myGamePiece.hp,"k":kills};
      socket.emit('id4', ship4);
    }
  }

}, 200);
}

// running interval functions to send data
dataS1();

/////////////// END OF SHIP POSITION SENDING


</script>

</body>
</html>
